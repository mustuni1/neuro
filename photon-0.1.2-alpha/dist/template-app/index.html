<!DOCTYPE html>
<html>

<head>
    <title>Photon</title>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../css/photon.min.css">
    <!-- Javascript -->
    <script src="js/menu.js" charset="utf-8"></script>
    <style>
    .padded-more {
        width: 100%;
        text-align: center;
    }
    </style>
</head>

<body>
    <div class="window">
        <!-- .toolbar-header sits at the top of your app -->
        <!-- <header class="toolbar toolbar-header">
        <h1 class="title">Photon</h1>
      </header> -->
        <!-- Your app's content goes inside .window-content -->
        <div class="window-content">
            <div class="padded-more">
                <div class="btn-group 0">
                </div>
                </br>
                </br>
                <div class="btn-group 1">
                </div>
                </br>
                </br>
                <div class="btn-group 2">
                </div>
                </br>
                </br>
                <button class="btn btn-default btn-large">&nbsp;</button>
                </br>
                </br>
                <div>
                    <p id="output">Your Entered Text</p>
                </div>
            </div>
        </div>
    </div>
    <script>
    var numUsedBlinks = 0;
    var $output = $("#output");
    var initialized = false;

    var alphabet = "abcdefghijklmnopqrstuvwxyz";
    var mainArray = alphabet.split('');
    var subArray = mainArray.slice(0);

    $(document).on("click", ".btn", function() {
        var $this = $(this);
        var text = initialized ? $output.text() : "";
        initialized = true;
        $output.text(text + $this.text());
    });

    $(function() {
        makeButtons();
    })

    window.onkeyup = function(e) { //use keys a, s, d, which map to 65, 83, 68

        if (e.which == 65)
            go(0);
        else if (e.which == 83)
            go(1);
        else if (e.which == 68)
            go(2);

    };

    function update() {
        try {
            jQuery.get('/Users/test/eeg_output.txt', function(data) {
                if (!data) {
                    return;
                }
                var lineByLine = data.split('\n');
                lineByLine.pop();
                console.log(lineByLine, numUsedBlinks, lineByLine.length);
                for (var i = numUsedBlinks; i < lineByLine.length; i++) {
                    console.log('hi', lineByLine[i]-1)
                    go(lineByLine[i] - 1);
                };
                numUsedBlinks = lineByLine.length;
            });
        } catch (e) {
            console.log(e);
        }

    }

    setInterval(update, 1);

    function typeLetter(child) {
        var $this = child;
        var text = initialized ? $output.text() : "";
        initialized = true;
        $output.text(text + $this.innerHTML);
        subArray = mainArray.slice(0);
        makeButtons()
    }

    function makeButtons() {
        for (var i = 0; i < 3; i++) {
            $("." + i).empty();
            tempArray = subArray.slice(subArray.length * i / 3, subArray.length * (i + 1) / 3);
            for (var j = 0; j < tempArray.length; j++) {
                var r = $('<button class = "btn btn-default">' + tempArray[j] + '</>');
                $("." + i).append(r);
            };
        };
    }

    function go(num) { //0-2
        if (num >= 0 && num <= 2) {
            console.log(num);
            if ($('.' + num).children().size() < 1) {} else if ($('.' + num).children().size() == 1) {
                typeLetter($('.' + num).children()[0]);
            } else {
                subArray = subArray.slice(subArray.length * num / 3, subArray.length * (num + 1) / 3);

                makeButtons();
            }
        }
    }
    </script>
</body>

</html>
